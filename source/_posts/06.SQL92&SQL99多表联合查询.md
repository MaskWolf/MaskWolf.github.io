---
title: 06.SQL92&SQL99多表联合查询
thumbnail: /images/sql-databse.jpg
toc: true
date: 2019-04-16 20:37:22
categories: 
tags:
	- SQL
---

**当需要获取的数据分布在多张表中时，考虑联合查询**
<!-- more -->
## SQL92联合查询
### 笛卡尔积
定义：将多个表的数据一一对应，所得结果为笛卡尔积，结果数量等于各表数量乘积
```sql
select * from emp,dept
```

### 等值连接
定义：先做表的笛卡尔积，然后筛选，筛选条件为等值筛选
注意：筛选所用字段值必须相同，字段名可以不同

```sql
select * from emp,dept where emp.deptno=dept.deptno
```
### 不等值连接
定义：先做表的笛卡尔积，然后筛选，筛选条件为非等值筛选
```sql
select * from emp e,salgrade s where e.sal>=s.losal and e.sal<=s.hisal
```
### 自连接
定义：同一张表做笛卡尔积，然后筛选
外连接
1. 左外连接：加在右边，显示左边对应字段没有值的数据
2. 右外连接：加在左边，显示右边对应字段没有值的数据

```sql
--查询员工姓名、工作、薪资、部门名称（等值连接）
	--可以直接在select子句中使用字段获取数据，但效率较低，建议字段名前应加上表名
	--注意：如果是公共字段，那么必须声明表名
	select ename,job,sal,dname from emp,dept where emp.deptno=dept.deptno
	select emp.ename,emp.job,emp.sal,dept.dname from emp,dept where emp.deptno=dept.deptno order by dept.dname
	--注意：表名太长时，我们可以对其使用别名
	select e.ename,e.job,e.sal,d.dname from emp as e,dept as d where e.deptno=d.deptno order by d.dname

--查询员工姓名、工作、工资、工资等级（非等值连接）
select e.ename,e.job,e.sal,s.grade from emp e,salgrade s where e.sal>=s.losal and e.sal<=s.hisal

--查询员工姓名、工作、薪资及上级领导姓名（自连接）
select e1.ename,e1.job,e1.sal,e2.ename from emp e1,emp e2 where e1.mgr=e2.empno

--查询员工姓名、工作、薪资及上级领导姓名及没有部门的员工信息（左外连接）
select * from emp e,dept d where e.deptno=d.deptno(+)

--查询员工姓名、工作、薪资及上级领导姓名及没有员工的部门信息（右外连接）
select * from emp e,dept d where e.deptno(+)=d.deptno
```

## SQL99多表联合查询
注意：
1. 可以给表添加别名
2. 如果使用on或者using关键字对结果进行筛选，必须使用inner join作为表与表的连接，其中inner可以省略不写
3. 外连接的outer关键字可以省略不写
4. 依然可以使用分组group by、排序order by等

### 笛卡尔积
select 内容 from 表名 cross join 表名
```sql
select * from emp cross join dept
```

### 自然连接
使用：select 内容 from 表名 natural join 表名
特点：底层先笛卡尔积，然后按照同名同值字段自动进行筛选
```sql
select * from emp natural join dept
```
问题：
1. 无法按照部分字段进行结果筛选
2. 无法按照字段名不同，但字段值相同进行等值筛选

#### 解决1：使用 using 关键字
作用：使用指定的字段对联合查询的结果进行等值筛选
注意：指明的字段必须是两表的同名同值字段
使用：select 内容 from 表名 inner join 表名 using(字段名，字段名，...)
```sql
select * from emp inner join dept using(deptno)
```

#### 解决2：使用 on 关键字
使用：select 内容 from 表名 inner join 表名 on 连接条件 where 普通筛选条件
注意：普通筛选条件使用where进行筛选，不要使用on。好处：SQL语句的阅读性增强
```sql
select * from emp inner join dept on emp.deptno=dept.deptno
```

### 外连接
左外连接:select 内容 from 表名 left outer join 表名 on 连接条件
```sql
--查询员工姓名、工作、薪资、部门名称及没有部门的员工信息
select * from emp e left join dept d on e.deptno=d.deptno
```
右外连接:select 内容 from 表名 rigth outer join 表名 on 连接条件
```sql
--查询员工姓名、工作、薪资、部门名称及没有员工的部门信息
select * from emp e right join dept d on e.deptno=d.deptno
```
全外连接:select 内容 from 表名 full outer join 表名 on 连接条件
```sql
--查询员工姓名、工作、薪资、部门名称、没有部门的员工信息、没有员工的部门信息
select * from emp e full join dept d on e.deptno=d.deptno
```

### 自连接
```sql
--查询员工及其上级领导姓名
select * from emp e1 inner join emp e2 on e1.mgr=e2.empno
```

---
title: 03.单行&多行&转换&其他函数
thumbnail: /images/sql-databse.jpg
toc: true
date: 2019-04-15 23:25:24
categories: 
tags:
	- SQL
---

## 单行函数
### 字符函数
<!-- more -->
|函数|功能|示例|结果|
|:---|:---|:---|:---|
|INITCAP(char)|首字母大写|intitcap('hello')|Hello|
|LOWER(char)|转换为小写|lower('FUN')|fun|
|UPPER(char)|转换为大写|upper('sun')|SUN|
|LTRIM(char,set)|左裁剪|ltrim('xyzadams','xyz')|adams|
|RTRIM(charmset)|右裁剪|rtrim('xyzadams','ams')|xyzad|
|TRANSLATE(char,from,to)|按字符翻译|translate('jack','abcd','1234')|j13k|
|REPLACE(char,serch_str,replace_str)|字符串替换|'jack and jue','j','bl'|black and blue|
|INSTR(char,substr[,pos])|查找子串位置|instr('worldwide','d')|5|
|SUBSTR(char,pos,len)|取子字符串|substr('abcdefg',3,2)|cd|
|CONCAT(char1,char2)|连接字符串|concat('Hello','world')|Helloworld|

### 数值函数
|函数|功能|示例|结果|
|:---|:---|:---|:---|
|ABS(n)|取绝对值|abs(-15)|15|
|CEIL()|向上取整|ceil(44.778)|45|
|SIN(n)|正弦|sin(1.571)|0.999999979|
|COS(n)|余弦|cos(0)|1|
|SIGN(n)|取符号|sign(-30)|-1|
|FLOOR(n)|向下取整|floor(100.2)|100|
|POWER(m,n)|m的n次幂|pow(4.2)|16|
|MOD(m,n)|取余数|mod(10,3)|1|
|ROUND(m,n)|四舍五入|round(100.256,2)|100.26|
|TRUNC(m,n)|截断|trunc(100.256,2)|100.25|
|SQRT(n)|平方根|sqrt(4)|2|

### 日期函数
|函数|功能|示例|结果|
|:---|:---|:---|:---|
|MONTHS_BETWEEN|返回两个日期间的月份|months_between ('04-11月-2005','11-1月-01')|57.7741935|
|ADD_MONTHS|返回把月份数加到日期上的新日期|add_months('06-2月-03',1)<br>add_months('06-2月-03',-1)|06-3月-2003<br>06-1月-2003|
|NEXT_DAY|返回指定日期后的星期对应的新日期|next_day('06-2月-2003','星期一')|10-2月-2003|
|LAST_DAY|返回指定日期所在月的最后一天|last_day('06-2月-2003')|28-2月-2003|
|ROUND|按指定格式对日期进行四舍五入|round(to_date('13-2月-2003'),'YEAR') <br>round(to_date('13-2月-2003'),'MONTH')<br>round(to_date('13-2月-2003'),'DAY')|01-1月-2003<br>01-2月-2003<br>16-2月-2003|
|TRUNC|对日期按指定方式进行截断|trunc(to_date('06-2月-2003'),'YEAR')<br>trunc(to_date('06-2月-2003'),'MONTH')<br>trunc(to_date('06-2月-2003'),'DAY')|01-1月-2003<br>01-2月-2003<br>02-2月-2003|

## *多行函数
|函数|功能|
|:---|:---|
|MAX|返回该字段的最大值|
|MIN|返回该字段的最小值|
|SUM|返回该字段的和|
|AVG|返回该字段的平均值|
|COUNT|count(*) 返回表的记录数<br>count(字段名) 返回非空值的数量<br>count(distinct 字段名) 去除重复后的字段值的数量|

## 转化函数
- to_number(数值类型的字符)：将字符转换为数值
- to_char(数值或者是日期)：将数值或者日期转换为字符
- to_date(日期格式的字符)：将字符转换为日期

### 数值和字符的互相转换
#### 字符转换为数字
```sql
select to_number('123')+2  from dual
```
#### 数字转换字符
指定显示格式
- 9表示位置占位，例如999,999,999会将数字按照三个一组使用逗号隔开
- L表示人民币符号，$表示美元符号
- 0可以进行占位分组，但是如果真实数据位数不足，会使用0进行补位

```sql
select to_char(123456789,'L999,999,999') from dual
select to_char(123456789,'$999,999,999') from dual
select to_char(123456789,'000,000,000,000.000') from dual
```
数值和字符之间的转换可以隐式转换。to_number可以省略不写
```sql
--查询工资大于2000的员工信息
select * from emp where sal>'2000';
select * from emp where sal>to_number('2000');
```

### 日期和字符的互相转换
一般使用时机：新增数据使用to_date(),查询数据使用to_char()

#### 字符转换为日期
使用to_date('要转换的字符',日期格式)函数将字符转换为日期
- 注意1：字符必须符合日期格式
- 注意2:oralce默认的转换格式为日月年，例如'01-1月-2018' oracle认为是一个日期
- 常用日期格式：yyyy-mm-dd、yyyy/mm/dd

```sql
--查询员工入职日期在82年后的信息
	select * from emp where hiredate >to_date('1982-01-01','yyyy-mm-dd')
	select * from emp where hiredate >to_date('1982/01/01','yyyy/mm/dd')
	select * from emp where to_char(hiredate,'yyyy-mm-dd') >'1982-01-01'
```

#### 日期转换为字符
使用to_char('要转换的日期',转换格式)
- 注意：如果不指名转换格式，则使用默认格式，日月年例如:'01-1月-81'
- 常用转换格式：yyyy-mm-dd、yyyy/mm/dd、'yyyy"年"mm"月"dd"日"

```sql
select to_char(hiredate) from emp	--使用默认格式将日期转换为字符
select to_char(hiredate,'yyyy-mm-dd') from emp	--使用指定格式  yyyy-mm-dd
select to_char(hiredate,'yyyy/mm/dd') from emp	--使用指定格式 yyyy/mmm/dd
select to_char(hiredate,'yyyy"年"mm"月"dd"日"') from emp	--使用指定格式 'yyyy"年"mm"月"dd"日"'
```

## 其他函数
1. nvl():nvl(字段名,值)
如果字段值不为null返回字段值，否则返回设定的值
2. nvl2()：nvl2(字段名，处理1，处理2)
如果字段值不为null执行处理1，否则执行处理2
3. decode()：decode(字段名，值1，处理1，值2，处理2，值3，处理3，...公共处理)
如果字段的值与decode中的条件值相同则执行对象的处理，否则执行公共处理

```sql
--查询员工的工资
select ename,job,sal from emp
--查询员工的薪资
select ename,job,sal+nvl(comm,0),sal+comm,sal from emp
select ename,job,nvl2(comm,sal+comm,sal) from emp
--显示员工的职称
select ename,job,decode(job,'MANAGER','经理','PRESIDENT','董事长','SALESMAN','销售','普通员工') from emp
```
